define("./index",["./util/class","./flow","./step","./condition","./input"],function(a,b,c){window.Flowjs={Class:a("./util/class"),Flow:a("./flow"),Step:a("./step"),Condition:a("./condition"),Input:a("./input")}});
define("./util/class",["./baseobject"],function(a,b,c){var d=a("./baseobject"),e=function(a){var b=a.extend||d,c=function(){},e=a.plugins||[];c.prototype=b.prototype;var f=a.construct||function(){},g=a.properties||{},h=a.methods||{},i=a.statics||{},j=new c;for(var k in j)j.hasOwnProperty(k)&&delete j[k];for(var k in g)j[k]=g[k];for(var k in h)j[k]=h[k];for(var l=0;l<e.length;l++){var m=e[l];for(var k in m)j[k]=m[k]}j.constructor=f,j.superclass=b,f.prototype=j;for(var k in i)f[k]=i[k];return f};e.abstractMethod=function(){throw new Error("Not implement.")},c.exports=e});
define("./util/baseobject",[],function(a,b,c){var d=function(){},e=new Object;e.superclass=Object,e.callsuper=function(a){var b=this;this._realsuper?this._realsuper=this._realsuper.prototype.superclass:this._realsuper=this.superclass;if(typeof a=="string"){var c=Array.prototype.slice.call(arguments,1);b._realsuper.prototype[a].apply(b,c)}else{var c=Array.prototype.slice.call(arguments,0);b._realsuper.apply(b,c)}this._realsuper=null},d.prototype=e,c.exports=d});
define("./flow",["./util/class","./util/eventPlugin","./util/extend","./begin","./step","./util/queue","./util/flowData"],function(a,b,c){var d=a("./util/class"),e=a("./util/eventPlugin"),f=a("./util/extend"),g=a("./begin"),h=a("./step"),i=a("./util/queue"),j=a("./util/flowData"),k=d({plugins:[new e],construct:function(a){this._begin=new g({description:"Begin",struct:{}}),this._steps=a.steps,this._curr=this._begin,this._queue=new i,this._started=!1,this._timer=null,this._prev=this._begin,this._data=new j},methods:{start:d.abstractMethod,go:function(a,b){var c=this;this._queue.enqueue({step:a,data:b}),this._prev&&this._prev.next(a),this._prev=a,this._timer&&clearTimeout(this._timer),this._timer=setTimeout(function(){a.end(),c._start()},0)},_start:function(){var a=this._queue.dequeue();a&&this._process(a.step,a.data||this._getStepData(a.step))},_process:function(a,b){this._enter(a,b,function(b){b&&this._saveData(b);var c=this._getNext(a);if(c){var d=this._getStepData(c);this._process(c,d)}})},_saveData:function(a){for(var b in a)a.hasOwnProperty(b)&&this._data.setData(b,a[b])},_getNext:function(a){var b=a.__result,c=null,d=this._queue.dequeue(),c=null;return d?c=d.step:c=a.next(),c},_getStepData:function(a){var b=a.getStruct(),c=[];if(b&&b.input)for(var d in b.input)b.input.hasOwnProperty(d)&&c.push(d);return this._data.getData(c)},_enter:function(a,b,c){var d=this;this._curr=a,a.enter(b,function(b,e){a.__result=e,c.call(d,e)})}}});c.exports=k});
define("./util/eventPlugin",["./class"],function(a,b,c){var d=a("./class"),e=d({methods:{on:function(a,b){this._ep_createList();var c=function(a){b(a)};return a=a.toLowerCase(),this._ep_lists[a]=this._ep_lists[a]||[],this._ep_lists[a].push({type:a,listener:b,realListener:c}),this},un:function(a,b){this._ep_createList();if(a){a=a.toLowerCase();var c=this._ep_lists[a];if(c){var d=c.length,e=!b;c&&c.length>0&&(e==1?this._ep_lists[a]=[]:c.forEach(function(a,d){a.listener===b&&c.splice(d,1)}))}}else this._ep_clearList();return this},fire:function(a){this._ep_createList();var b=a.type.toLowerCase(),c=a.data,d=this._ep_lists[b];return d&&d.length>0&&d.forEach(function(a,d){a.listener({type:b,data:c})}),this},_ep_clearList:function(){this._ep_lists=null},_ep_createList:function(){this._ep_lists||(this._ep_lists={})}}});c.exports=e});
define("./util/extend",[],function(a,b,c){var d=function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a};c.exports=d});
define("./begin",["./util/class","./step"],function(a,b,c){var d=a("./util/class"),e=a("./step"),f=d({extend:e,construct:function(a){this.callsuper(a)}});c.exports=f});
define("./step",["./util/class","./util/eventPlugin","./util/checkData"],function(a,b,c){var d=a("./util/class"),e=a("./util/eventPlugin"),f=a("./util/checkData"),g=d({plugins:[new e],construct:function(a){a=a||{};if(!a.description)throw new Error("Need a description.");this._data={},this._data.description=a.description,this._struct=this._describeData(),this._next=null,this._end=!1},methods:{enter:function(a,b){if(!this.__checkInput(a))throw new Error("Data error.");var c=this;this._process(a,function(a,d){if(!c.__checkOutput(d))throw new Error("Result error.");b(a,d)})},_process:d.abstractMethod,_describeData:function(){return{}},next:function(a){if(!a)return this._next;this.isEnd()||(this._next=a)},end:function(){this._end=!0},isEnd:function(){return this._end},data:function(){return this._data},getStruct:function(){return this._struct},__checkInput:function(a){return f.check(this._struct.input,a)},__checkOutput:function(a){return f.check(this._struct.output,a)}}});c.exports=g});
define("./util/checkData",["./tool"],function(a,b,c){var d=a("./tool");c.exports={check:function(a,b){var c=this;if(!a)return!0;var d=!0;for(var e in a){var f=a[e];if(a[e].empty!==!0&&c.isEmpty(a[e],b[e]))throw new Error("字段["+e+"]值为空");if(a[e].empty===!0&&c.isEmpty(a[e],b[e]))continue;if(a[e].type=="number"&&typeof b[e]!="number")throw new Error("字段["+e+"]不是数字");if(a[e].type=="string"&&typeof b[e]!="string")throw new Error("字段["+e+"]不是字符串");if(a[e].type=="array"){if(!c.checkArray(a[e],b[e]))throw new Error("字段["+e+"]值与定义不符")}else if(a[e].type=="object"&&!c.checkObject(a[e].struct,b[e]))throw new Error("字段["+e+"]值与定义不符")}return d},checkArray:function(a,b){var c=this;if(d.isArray(b)){for(var e=0;e<b.length;e++){var f=b[e];if(!c.checkData(a.item,f))return!1}return!0}return!1},checkObject:function(a,b){return this.check(a,b)},isEmpty:function(a,b){return b===undefined?!0:a.type=="object"?b===null:a.type=="array"?b.length==0:b===""||b===undefined||b===null},checkData:function(a,b){return a.type=="number"&&typeof b=="number"?!0:a.type=="string"&&typeof b=="string"?!0:a.type=="boolean"&&typeof b=="boolean"?!0:a.type=="array"?this.checkArray(a.item,b):a.type=="object"?this.checkObject(a.struct,b):!1}}});
define("./util/tool",[],function(a,b,c){c.exports={isArray:Array.isArray||function(a){return Object.prototype.toString.call(a)=="[object Array]"}}});
define("./util/queue",["./class"],function(a,b,c){var d=a("./class");c.exports=d({construct:function(){this._queue=[],this._event={}},methods:{enqueue:function(a){this._queue.push(a)},dequeue:function(){var a=this;return this._queue.length==0?(this.end(),null):this._queue.splice(0,1)[0]},isEmpty:function(){return this._queue.length==0},end:function(a){this.fire("end",a)},on:function(a,b){this._event[a]||(this._event[a]=[]),this._event[a].push(b)},fire:function(a,b){if(this._event[a])for(var c=0;c<this._event[a].length;c++)this._event[a][c](b)},clear:function(){this._queue=[]}}})});
define("./util/flowData",["./class","./tool"],function(a,b,c){var d=a("./class"),e=a("./tool"),f=d({construct:function(a){this._data={}},methods:{getData:function(a){var b={},c=(new Date).getTime();if(e.isArray(a)){var d=a.length;for(var f=0;f<d;f++){var g=a[f];this._data.hasOwnProperty(g)&&(b[g]=this._data[g])}}else b[a.toString()]=this_data[a.toString()];return b},setData:function(a,b){return this._data[a]=b,!1}}});c.exports=f});
define("./condition",["./util/class","./step"],function(a,b,c){var d=a("./util/class"),e=a("./step"),f=d({extend:e,construct:function(a){this.callsuper(a),this._cases=a.cases||{},this._default=a.defaultCase},methods:{_select:function(a){var b=this._cases[a]||this._default;b()},cases:function(){return{defaultCase:this._default,cases:this._cases}}}});c.exports=f});
define("./input",["./util/class","./step"],function(a,b,c){var d=a("./util/class"),e=a("./step"),f=d({extend:e,construct:function(a){this.callsuper(a),this._inputs=a.inputs||{},this._waiting=!1},methods:{_wait:function(a){this._waiting||(this._waiting=!0,a())},inputs:function(){return this._inputs}}});c.exports=f});